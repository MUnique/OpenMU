@using System.ComponentModel.DataAnnotations
@using System.Diagnostics.CodeAnalysis
@using MUnique.OpenMU.DataModel.Configuration
@using MUnique.OpenMU.DataModel.Entities
@using MUnique.OpenMU.Web.ItemEditor
@inherits NotifyableInputBase<ItemStorage>

<div>
    <FieldLabel Text="@Label" ValueExpression="@this.ValueExpression" />
    <MuItemStorage @bind-Value="@CurrentValue" id="@this.FieldIdentifier.FieldName" class="@CssClass" StorageType="@this.StorageType" />
    <ValidationMessage For=@this.ValueExpression />
</div>

@code {

    /// <summary>
    /// Gets or sets the label which should be displayed. If it's not explicitly provided, the component shows the
    /// Name defined in the <see cref="DisplayAttribute"/>. If there is no Name in a <see cref="DisplayAttribute"/>, it shows the property name instead.
    /// </summary>
    [Parameter]
    public string Label { get; set; } = string.Empty;

    private StorageType StorageType
    {
        get
        {
            var model = this.EditContext.Model;
            if (model is Account)
            {
                return StorageType.Vault;
            }

            if (model is Character)
            {
                return StorageType.Inventory;
            }

            if (model is MonsterDefinition)
            {
                return StorageType.Merchant;
            }

            throw new NotImplementedException($"Unknown owner ({model}) of storage.");
        }
    }



    protected override void OnParametersSet()
    {
        base.OnParametersSet();
        
        //this.ViewModel = this.CurrentValue.CreateViewModel()
    }

    /// <inheritdoc />
    protected override bool TryParseValueFromString(string? value, [MaybeNullWhen(false)] out ItemStorage result, [NotNullWhen(false)] out string? validationErrorMessage)
    {
        throw new NotImplementedException();
        
        validationErrorMessage = null;
        return true;
    }

    /// <inheritdoc />
    protected override string FormatValueAsString(ItemStorage? value)
    {
        return value is null ? string.Empty : string.Join(';', value);
    }
}
